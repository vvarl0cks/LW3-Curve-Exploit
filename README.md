## $60M hack on Curve Finance: Technical breakdown and reproducing the hack | Learn Web3 DAO Community   

Hopefully, through this lesson, you learnt more about flash loans, re-entrancy, the Curve exploit, and some more hands-on experience with Foundry. If at any point something didn't work as expected or you have any questions, reach out on our Discord Server and someone will be there to help you out!

With that, cheers, and have a great rest of your day! ðŸ¥‚   

## Lesson   
Learn Web3 DAO âž¡ https://learnweb3.io/lessons/60-m-hack-on-curve-finance-technical-breakdown-and-reproducing-the-hack   

## Foundry

**Foundry is a blazing fast, portable and modular toolkit for Ethereum application development written in Rust.**

Foundry consists of:

-   **Forge**: Ethereum testing framework (like Truffle, Hardhat and DappTools).
-   **Cast**: Swiss army knife for interacting with EVM smart contracts, sending transactions and getting chain data.
-   **Anvil**: Local Ethereum node, akin to Ganache, Hardhat Network.
-   **Chisel**: Fast, utilitarian, and verbose solidity REPL.

### Foundry in CDE (bash shell)   

```shell
source /home/gitpod/.bashrc
```

## Testing the contract   

```shell
forge test --mp ./test/CurveHackOne.t.sol -vvv
```

```shell
gitpod /workspace/LW3-Curve-Exploit (main) $ forge test --mp ./test/CurveHackOne.t.sol -vvv
[â Š] Compiling...
[â ”] Installing solc version 0.8.21
[â ‘] Successfully installed solc 0.8.21
[â Š] Compiling 24 files with 0.8.21
[â ”] Solc 0.8.21 finished in 5.21s
Compiler run successful!

Running 1 test for test/CurveHackOne.t.sol:CurveHack
[PASS] testHack() (gas: 635369)
Logs:
  @ï¿½Before Add Liquidity #1: Curve LP Total Supply: 11215.401298916882158302
  @ï¿½Before Add Liquidity #1: Curve ETH Balance: 6185.349303687829485975
  @ï¿½Before Add Liquidity #1: Curve pETH Balance: 5036.051407828592250117
  @ï¿½Before Add Liquidity #1: Attacker LP Balance: 0.000000000000000000
  @ï¿½Before Add Liquidity #1: Attacker ETH Balance: 80000.000000000000000000
  @ï¿½Before Add Liquidity #1: Attacker pETH Balance: 0.000000000000000000
  =====================================================
  @ï¿½After Add Liquidity #1: Curve LP Total Supply: 43646.820214778998853971
  @ï¿½After Add Liquidity #1: Curve ETH Balance: 46183.138428822500011201
  @ï¿½After Add Liquidity #1: Curve pETH Balance: 5034.594719497689579821
  @ï¿½After Add Liquidity #1: Attacker LP Balance: 32431.418915862116695669
  @ï¿½After Add Liquidity #1: Attacker ETH Balance: 40000.000000000000000000
  @ï¿½After Add Liquidity #1: Attacker pETH Balance: 0.000000000000000000
  =====================================================
  @ï¿½$ReEntrancy - Before Add Liquidity #2: Curve LP Total Supply: 43646.820214778998853971
  @ï¿½$ReEntrancy - Before Add Liquidity #2: Curve ETH Balance: 11867.128651614574253336
  @ï¿½$ReEntrancy - Before Add Liquidity #2: Curve pETH Balance: 5034.594719497689579821
  @ï¿½$ReEntrancy - Before Add Liquidity #2: Attacker LP Balance: 32431.418915862116695669
  @ï¿½$ReEntrancy - Before Add Liquidity #2: Attacker ETH Balance: 74316.009777207925757865
  @ï¿½$ReEntrancy - Before Add Liquidity #2: Attacker pETH Balance: 0.000000000000000000
  =====================================================
  @ï¿½#ReEntrancy - After Add Liquidity #2: Curve LP Total Supply: 125829.583850937885021795
  @ï¿½#ReEntrancy - After Add Liquidity #2: Curve ETH Balance: 51865.363607976483701736
  @ï¿½#ReEntrancy - After Add Liquidity #2: Curve pETH Balance: 5033.646545779488068684
  @ï¿½#ReEntrancy - After Add Liquidity #2: Attacker LP Balance: 114614.182552021002863493
  @ï¿½#ReEntrancy - After Add Liquidity #2: Attacker ETH Balance: 34316.009777207925757865
  @ï¿½#ReEntrancy - After Add Liquidity #2: Attacker pETH Balance: 0.000000000000000000
  =====================================================
  @ï¿½After Remove Liquidity #1: Curve LP Total Supply: 11215.401298916882158302
  @ï¿½After Remove Liquidity #1: Curve ETH Balance: 51865.363607976483701736
  @ï¿½After Remove Liquidity #1: Curve pETH Balance: 1293.435941725442333962
  @ï¿½After Remove Liquidity #1: Attacker LP Balance: 82182.763636158886167824
  @ï¿½After Remove Liquidity #1: Attacker ETH Balance: 34316.009777207925757865
  @ï¿½After Remove Liquidity #1: Attacker pETH Balance: 3740.210604054045734722
  =====================================================
  @ï¿½After Remove Liquidity #2: Curve LP Total Supply: 1000.000000000000000000
  @ï¿½After Remove Liquidity #2: Curve ETH Balance: 4624.476844442948027234
  @ï¿½After Remove Liquidity #2: Curve pETH Balance: 115.326764263919366841
  @ï¿½After Remove Liquidity #2: Attacker LP Balance: 71967.362337242004009522
  @ï¿½After Remove Liquidity #2: Attacker ETH Balance: 81556.896540741461432367
  @ï¿½After Remove Liquidity #2: Attacker pETH Balance: 4918.319781515568701843
  =====================================================
  @ï¿½fter swapping pETH for ETH: Curve LP Total Supply: 1000.000000000000000000
  @ï¿½fter swapping pETH for ETH: Curve ETH Balance: 91.131333180571511827
  @ï¿½fter swapping pETH for ETH: Curve pETH Balance: 5033.646545779488068684
  @ï¿½fter swapping pETH for ETH: Attacker LP Balance: 71967.362337242004009522
  @ï¿½fter swapping pETH for ETH: Attacker ETH Balance: 86089.335201531491003082
  @ï¿½fter swapping pETH for ETH: Attacker pETH Balance: 0.000000000000000000
  =====================================================
  ETH in Profits: : 6089.335201531491003082

Test result: ok. 1 passed; 0 failed; 0 skipped; finished in 3.82s
Ran 1 test suites: 1 tests passed, 0 failed, 0 skipped (1 total tests)
```
